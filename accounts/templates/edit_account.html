{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}

<div class="row">
  <div class="col-md-8">
    <h1>Editar Cuenta</h1>
    <form method="post" enctype="multipart/form-data" id="accountForm">
      {% csrf_token %}
      <div class="form-group col-md-6">
        <label for="id_name">Nombre</label>
        <input type="text" class="form-control" id="id_name" name="name" value="{{ account.name }}">
      </div>
      <div class="form-group col-md-6">
        <label for="id_parent">Padre</label>
        <select class="form-control" id="id_parent" name="parent">
          <option value="">---------</option>
          {% for parent_id, parent_hierarchy in parents %}
            <option value="{{ parent_id }}" {% if parent_id == account.parent.id %}selected{% endif %}>
              {{ parent_hierarchy }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group col-md-6">
        <label for="id_name">Ruta por defecto</label>
        <input type="text" class="form-control" id="id_default_path" name="default_path" value="{{ account.default_path }}">
      </div>
      <div class="form-group form-check col-md-6">
        <div class="ml-4">
          <input type="checkbox" class="form-check-input" id="id_closed" name="closed" {% if account.closed %}checked{% endif %}>
          <label class="form-check-label" for="id_closed">Cerrada</label>
        </div>
        <small class="form-text text-muted">Marcar si la cuenta ya no se usa activamente.</small>
      </div>
    </form>
  </div>

  <div class="col-md-4">
    <h2>Adjuntos</h2>
    <div class="scrollable-section">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Archivo</th>
            <th>Descripción</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for attachment in account.attachments.all %}
          <tr data-attachment-id="{{ attachment.id }}">
            <td>
              <button type="button" class="btn btn-link" onclick="window.open('{{ attachment.file.url }}', '_blank')">
                <i class="fas fa-paperclip"></i>
              </button>
            </td>
            <td contenteditable="true" class="editable-description">{{ attachment.description }}</td>
            <td>
              <button type="button" class="btn btn-danger btn-sm delete-attachment">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div id="dropArea" class="drop-area">
        Arrastra y suelta archivos aquí o haz clic para seleccionar archivos
        <input type="file" id="fileInput" multiple style="display: none;">
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-8">
    <div class="d-flex justify-content-between align-items-center">
      <h2>Transacciones</h2>
      <div>
        <select id="periodSelector" class="form-select">
          <option value="current_month">Mes actual</option>
          <option value="last_month">Mes anterior</option>
          <option value="last_30_days">Últimos 30 días</option>
          <option value="last_60_days" selected>Últimos 60 días</option>
          <option value="last_180_days">Últimos 180 días</option>
          <option value="current_year">Año actual</option>
          <option value="last_year">Año anterior</option>
          <option value="year_before">Año atrás</option>
          <option value="last_3_years">3 años atrás</option>
          <option value="last_5_years">5 años atrás</option>
          <option value="last_10_years">10 años atrás</option>
          <option value="all">Todos los registros</option>
        </select>
        <a href="/entries/add_entry/" class="btn btn-sm">
          <i class="bi bi-plus-circle"></i>
        </a>
      </div>
    </div>    
    <div id="transactionsTable"></div>
  </div>

  <div class="col-md-4">
    <h2>Palabras Asociadas</h2>
    <div class="scrollable-section">
      <table id="keywordsTable" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Palabra</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for keyword in account.keywords.all %}
          <tr data-keyword-id="{{ keyword.id }}">
            <td>
              <input type="text" class="form-control keyword-input" value="{{ keyword.keyword }}">
            </td>
            <td>
              <button type="button" class="btn btn-danger btn-sm delete-keyword">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
          <tr data-keyword-id="None">
            <td>
              <input type="text" class="form-control keyword-input" placeholder="Nueva palabra">
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
